(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[965],{9029:function(e,t,a){Promise.resolve().then(a.bind(a,9497))},9497:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var l=a(7437),s=a(2265),d=a(5876);function r(e){let{open:t,lead:a,onClose:r,onUpdateStatus:c,onAddNote:i,onDeleteNote:n,updatingStatus:o,updateError:x}=e,[b,p]=(0,s.useState)(""),[m,u]=(0,s.useState)(null);return((0,s.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&r()};return document.body.style.overflow="hidden",window.addEventListener("keydown",e),()=>{document.body.style.overflow="",window.removeEventListener("keydown",e)}},[t,r]),(0,s.useEffect)(()=>{t&&(p(""),u(null))},[t,null==a?void 0:a.id]),t&&a)?(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:r,children:(0,l.jsxs)("div",{className:"relative w-full max-w-[720px] rounded-xl border border-black/10 bg-white p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{type:"button",onClick:r,className:"absolute right-4 top-4 rounded-md border border-black/10 bg-white px-2 py-1 text-[12px] font-semibold text-black hover:bg-black/5",children:"Close"}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-black",children:"Lead Details"}),(0,l.jsxs)("p",{className:"text-[13px] text-black/60",children:["Submitted ",new Date(a.createdAt).toLocaleString()]})]}),(0,l.jsxs)("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[(0,l.jsxs)("div",{className:"rounded-lg border border-black/10 p-4",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Contact"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-[14px] text-black",children:[(0,l.jsx)("div",{className:"font-semibold",children:a.fullName}),(0,l.jsx)("div",{children:a.email}),(0,l.jsx)("div",{children:a.phone||"No phone provided"})]})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-black/10 p-4",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Package"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-[14px] text-black",children:[(0,l.jsx)("div",{className:"font-semibold",children:a.packageTitle}),(0,l.jsx)("div",{children:a.destination}),(0,l.jsx)("div",{children:a.treatmentCategory})]})]})]}),(0,l.jsxs)("div",{className:"mt-4 rounded-lg border border-black/10 p-4 text-[14px] text-black",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Message"}),(0,l.jsx)("div",{className:"mt-2 whitespace-pre-line text-[14px] text-black/80",children:a.message||"No message provided."})]}),(0,l.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,l.jsxs)("div",{className:"rounded-lg border border-black/10 p-4 text-[14px] text-black",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Locale"}),(0,l.jsx)("div",{className:"mt-2",children:a.locale})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-black/10 p-4 text-[14px] text-black",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Status"}),(0,l.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:d.PT.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>c(a.id,e),disabled:o||a.status===e,className:"rounded-lg border px-3 py-1 text-[12px] font-semibold ".concat(a.status===e?"border-black bg-black text-white":"border-black/20 text-black hover:bg-black/5"," ").concat(o?"opacity-50":""),children:e},e))}),x&&(0,l.jsx)("div",{className:"mt-2 text-[12px] text-red-600",children:x})]})]}),(0,l.jsxs)("div",{className:"mt-4 rounded-lg border border-black/10 p-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:"Notes / Internal Comments"}),(0,l.jsx)("div",{className:"text-[12px] text-black/60",children:"Internal only. L\xfctfen telefon/e-posta gibi PII yazmayÄ±n."})]}),(0,l.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,l.jsx)("textarea",{value:b,onChange:e=>{p(e.target.value),m&&u(null)},maxLength:1e3,rows:3,placeholder:"Add an internal note...",className:"w-full rounded-lg border border-black/20 p-3 text-[13px] text-black focus:border-black focus:outline-none"}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[(0,l.jsxs)("span",{children:[b.trim().length,"/",1e3]}),(0,l.jsx)("button",{type:"button",onClick:()=>{let e=b.trim();if(!e){u("Note cannot be empty.");return}if(e.length>1e3){u("Note is too long.");return}i(a.id,e),p("")},className:"rounded-lg border border-black/20 px-3 py-1 text-[12px] font-semibold text-black hover:bg-black/5",children:"Add note"})]}),m&&(0,l.jsx)("div",{className:"text-[12px] text-red-600",children:m})]}),(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[0===a.notes.length&&(0,l.jsx)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3 text-[12px] text-black/60",children:"No notes yet."}),a.notes.map(e=>(0,l.jsxs)("div",{className:"rounded-lg border border-black/10 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[(0,l.jsx)("span",{children:new Date(e.createdAt).toLocaleString()}),(0,l.jsx)("button",{type:"button",onClick:()=>n(a.id,e.id),className:"text-[12px] font-semibold text-black hover:text-black/70",children:"Delete"})]}),(0,l.jsx)("p",{className:"mt-2 whitespace-pre-line text-[13px] text-black/80",children:e.text})]},e.id))]})]})]})}):null}function c(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(!0),[i,n]=(0,s.useState)(!1),[o,x]=(0,s.useState)(""),[b,p]=(0,s.useState)("ALL"),[m,u]=(0,s.useState)(null),[h,k]=(0,s.useState)(!1),[f,g]=(0,s.useState)(!1),[j,v]=(0,s.useState)(null),N=async()=>{c(!0),n(!1);try{let e=await fetch("/api/leads",{method:"GET"});if(!e.ok)throw Error("Failed to load");let a=await e.json();t(Array.isArray(a.leads)?a.leads:[])}catch(e){n(!0)}finally{c(!1)}};(0,s.useEffect)(()=>{N()},[]);let y=(0,s.useMemo)(()=>{let t=o.trim().toLowerCase();return e.filter(e=>("ALL"===b||e.status===b)&&(!t||e.fullName.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},[e,o,b]),w=e=>{u(e),v(null),k(!0)},C=async(a,l)=>{let s=e.find(e=>e.id===a);if(s&&s.status!==l){g(!0),v(null);try{if(!(await fetch("/api/leads",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,status:l})})).ok)throw Error("Update failed");t(e=>e.map(e=>e.id===a?{...e,status:l}:e)),u(e=>e&&e.id===a?{...e,status:l}:e)}catch(e){v("Update failed")}finally{g(!1)}}},S=async(e,a)=>{g(!0),v(null);try{let l=await fetch("/api/leads",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,noteText:a})});if(!l.ok)throw Error("Update failed");let s=await l.json();(null==s?void 0:s.lead)&&(t(t=>t.map(t=>t.id===e?s.lead:t)),u(t=>t&&t.id===e?s.lead:t))}catch(e){v("Update failed")}finally{g(!1)}},E=async(e,a)=>{g(!0),v(null);try{let l=await fetch("/api/leads",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,deleteNoteId:a})});if(!l.ok)throw Error("Update failed");let s=await l.json();(null==s?void 0:s.lead)&&(t(t=>t.map(t=>t.id===e?s.lead:t)),u(t=>t&&t.id===e?s.lead:t))}catch(e){v("Update failed")}finally{g(!1)}};return(0,l.jsxs)("main",{className:"min-h-screen bg-white",children:[(0,l.jsx)("div",{className:"border-b border-black/10",children:(0,l.jsxs)("div",{className:"mx-auto flex w-full max-w-[1200px] flex-col gap-3 px-6 py-6 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold text-black",children:"Leads Inbox"}),(0,l.jsx)("p",{className:"text-[13px] text-black/60",children:"Manage inbound lead requests"})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)("input",{type:"text",value:o,onChange:e=>x(e.target.value),placeholder:"Search name or email",className:"h-10 w-[220px] rounded-lg border border-black/20 px-3 text-[13px] text-black focus:border-black focus:outline-none"}),(0,l.jsxs)("select",{value:b,onChange:e=>p(e.target.value),className:"h-10 rounded-lg border border-black/20 px-3 text-[13px] text-black focus:border-black focus:outline-none",children:[(0,l.jsx)("option",{value:"ALL",children:"All statuses"}),d.PT.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsx)("button",{type:"button",onClick:()=>{x(""),p("ALL")},className:"h-10 rounded-lg border border-black/20 px-3 text-[13px] font-semibold text-black hover:bg-black/5",children:"Reset"})]})]})}),(0,l.jsxs)("section",{className:"mx-auto w-full max-w-[1200px] px-6 py-8",children:[a&&(0,l.jsx)("div",{className:"space-y-3",children:Array.from({length:6}).map((e,t)=>(0,l.jsx)("div",{className:"h-12 rounded-lg border border-black/10 bg-black/5 animate-pulse"},t))}),!a&&i&&(0,l.jsxs)("div",{className:"rounded-xl border border-black/10 bg-white p-6 text-center",children:[(0,l.jsx)("div",{className:"text-[14px] font-semibold text-black",children:"Failed to load leads"}),(0,l.jsx)("button",{type:"button",onClick:N,className:"mt-4 rounded-lg border border-black/20 px-4 py-2 text-[13px] font-semibold text-black hover:bg-black/5",children:"Retry"})]}),!a&&!i&&0===y.length&&(0,l.jsx)("div",{className:"rounded-xl border border-black/10 bg-white p-6 text-center text-[14px] text-black/70",children:"No leads yet"}),!a&&!i&&y.length>0&&(0,l.jsxs)("div",{className:"overflow-hidden rounded-xl border border-black/10 bg-white",children:[(0,l.jsxs)("div",{className:"grid grid-cols-[140px_1.2fr_1.2fr_1.5fr_120px_120px] gap-3 border-b border-black/10 bg-black/5 px-4 py-3 text-[12px] font-semibold uppercase tracking-wide text-black/60",children:[(0,l.jsx)("div",{children:"Date"}),(0,l.jsx)("div",{children:"Name"}),(0,l.jsx)("div",{children:"Email"}),(0,l.jsx)("div",{children:"Package"}),(0,l.jsx)("div",{children:"Status"}),(0,l.jsx)("div",{children:"Actions"})]}),y.map(e=>(0,l.jsxs)("div",{className:"grid cursor-pointer grid-cols-[140px_1.2fr_1.2fr_1.5fr_120px_120px] gap-3 border-b border-black/5 px-4 py-3 text-[13px] text-black last:border-b-0 hover:bg-black/5",onClick:()=>w(e),children:[(0,l.jsx)("div",{className:"text-[12px] text-black/60",children:new Date(e.createdAt).toLocaleDateString()}),(0,l.jsx)("div",{className:"font-semibold",children:e.fullName}),(0,l.jsx)("div",{children:e.email}),(0,l.jsx)("div",{className:"truncate",children:e.packageTitle}),(0,l.jsx)("div",{className:"text-[12px] font-semibold",children:e.status}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{type:"button",className:"rounded-lg border border-black/20 px-3 py-1 text-[12px] font-semibold text-black hover:bg-black/5",onClick:t=>{t.stopPropagation(),w(e)},children:"View"})})]},e.id))]})]}),(0,l.jsx)(r,{open:h,lead:m,onClose:()=>{k(!1),u(null),v(null)},onUpdateStatus:C,onAddNote:S,onDeleteNote:E,updatingStatus:f,updateError:j})]})}},5876:function(e,t,a){"use strict";a.d(t,{PT:function(){return l}});let l=["NEW","IN_REVIEW","OFFER_SENT","CLOSED"]}},function(e){e.O(0,[971,23,744],function(){return e(e.s=9029)}),_N_E=e.O()}]);