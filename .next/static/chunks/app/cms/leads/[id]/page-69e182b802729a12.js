(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{7566:function(e,t,a){Promise.resolve().then(a.bind(a,9886))},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"notFound")&&a.d(t,{notFound:function(){return s.notFound}}),a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},9886:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(7437),l=a(2265),r=a(6463),c=a(154),d=a(2036),n=a(5876),i=a(9064);function o(){let e=(0,r.useParams)(),t=null==e?void 0:e.id,{uiLocale:a}=(0,d.s)("de"),[o,x]=(0,l.useState)(null),[u,b]=(0,l.useState)(!0),[p,m]=(0,l.useState)(!1),[h,f]=(0,l.useState)(""),[v,j]=(0,l.useState)(null),[k,g]=(0,l.useState)(!1),[N,y]=(0,l.useState)(!1),[w,S]=(0,l.useState)(""),[T,O]=(0,l.useState)(""),[C,E]=(0,l.useState)(!1),[P,A]=(0,l.useState)(!1),F=e=>(0,c.t)(a,"leadStatus.".concat(e));(0,l.useEffect)(()=>{if(!t)return;let e=!0;return b(!0),m(!1),fetch("/api/cms/leads/".concat(t),{method:"GET"}).then(async t=>{if(!t.ok)throw Error("Failed");let a=await t.json();e&&x(a.lead)}).catch(()=>{e&&m(!0)}).finally(()=>{e&&b(!1)}),()=>{e=!1}},[t]);let L=(0,l.useMemo)(()=>{if(!o)return"-";let e=o.name||o.patientName||"";return e?(0,i.u3)(e):"-"},[o]),R=(0,l.useMemo)(()=>(null==o?void 0:o.email)?(0,i.of)(o.email):"-",[o]),D=(0,l.useMemo)(()=>(null==o?void 0:o.phone)?(0,i.yD)(o.phone):"-",[o]),_=async()=>{if(o){A(!0);try{let e=await fetch("/api/cms/leads/".concat(o.id,"/trustscore/recalc"),{method:"POST"});if(!e.ok){let t=await e.json();alert(t.error||"Failed to recalculate");return}let t=await e.json();x(e=>e?{...e,trustScore:t.scoreAfter,trustStatus:t.status}:e)}finally{A(!1)}}},I=async()=>{if(!o)return;let e=T.trim(),t=""===w.trim()?null:parseInt(w);if(null!==t&&(isNaN(t)||t<0||t>100)){alert("Score must be between 0 and 100");return}E(!0);try{let a=await fetch("/api/cms/leads/".concat(o.id,"/trustscore/override"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({scoreOverride:t,reason:e||null})});if(!a.ok){let e=await a.json();alert(e.error||"Failed to update override");return}await a.json();let s=await fetch("/api/cms/leads/".concat(o.id),{method:"GET"}),l=await s.json();x(l.lead),S(""),O("")}finally{E(!1)}},H=async()=>{if(o){S(""),O(""),E(!0);try{let e=await fetch("/api/cms/leads/".concat(o.id,"/trustscore/override"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({scoreOverride:null})});if(!e.ok){let t=await e.json();alert(t.error||"Failed to clear override");return}let t=await fetch("/api/cms/leads/".concat(o.id),{method:"GET"}),a=await t.json();x(a.lead)}finally{E(!1)}}},J=async e=>{if(o&&o.status!==e){g(!0);try{let t=await fetch("/api/cms/leads/".concat(o.id,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})});if(!t.ok)throw Error("Failed");let a=await t.json();x(e=>e?{...e,status:a.lead.status}:e)}finally{g(!1)}}},G=async()=>{let e=h.trim();if(!e){j((0,c.t)(a,"leads.notesEmpty"));return}if(e.length<2){j((0,c.t)(a,"leads.notesTooShort"));return}if(e.length>2e3){j((0,c.t)(a,"leads.notesTooLong"));return}if(o){y(!0),j(null);try{let t=await fetch("/api/cms/leads/".concat(o.id,"/notes"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});if(!t.ok)throw Error("Failed");let a=await t.json();x(a.lead),f("")}finally{y(!1)}}};return u?(0,s.jsx)("main",{className:"min-h-screen bg-white px-6 py-8 text-[13px] text-black/60",children:(0,c.t)(a,"leads.loading")}):p||!o?(0,s.jsx)("main",{className:"min-h-screen bg-white px-6 py-8 text-[13px] text-black/60",children:(0,c.t)(a,"leads.empty")}):(0,s.jsxs)("main",{className:"min-h-screen bg-white",children:[(0,s.jsx)("div",{className:"border-b border-black/10",children:(0,s.jsxs)("div",{className:"mx-auto flex w-full max-w-[1000px] flex-col gap-2 px-6 py-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-black",children:(0,c.t)(a,"leads.detailTitle")}),(0,s.jsx)("p",{className:"text-[13px] text-black/60",children:(0,c.t)(a,"leads.detailInfo")})]})}),(0,s.jsxs)("section",{className:"mx-auto w-full max-w-[1000px] px-6 py-8",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-black/10 bg-white p-4",children:[(0,s.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,c.t)(a,"leads.detailInfo")}),(0,s.jsxs)("div",{className:"mt-3 grid gap-2 text-[13px] text-black",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldId"),":"]})," ",o.id]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldCreatedAt"),":"]})," ",new Date(o.createdAt).toLocaleString()]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldLocale"),":"]})," ",o.locale||"-"]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldName"),":"]})," ",L]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldEmail"),":"]})," ",R]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-black/50",children:[(0,c.t)(a,"leads.fieldPhone"),":"]})," ",D]})]})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-black/10 bg-white p-4",children:[(0,s.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,c.t)(a,"leads.statusLabel")}),(0,s.jsx)("div",{className:"mt-3 grid gap-3",children:(0,s.jsx)("select",{value:o.status,onChange:e=>J(e.target.value),disabled:k,className:"h-10 rounded-lg border border-black/20 px-3 text-[13px] text-black focus:border-black focus:outline-none",children:n.PT.map(e=>(0,s.jsx)("option",{value:e,children:F(e)},e))})})]})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[(0,s.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,c.t)(a,"trustScore.panelTitle")}),(0,s.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3",children:[(0,s.jsx)("div",{className:"text-[11px] uppercase text-black/50",children:(0,c.t)(a,"trustScore.finalScore")}),(0,s.jsx)("div",{className:"mt-1 text-2xl font-bold text-black",children:o.trustScore}),(0,s.jsxs)("div",{className:"mt-1 text-[11px] text-black/60",children:[(0,c.t)(a,"trustScore.status.".concat(o.trustStatus)),null!==o.scoreOverride&&(0,s.jsx)("span",{className:"ml-2 rounded bg-yellow-200 px-1.5 py-0.5 text-[10px] font-semibold text-yellow-800",children:(0,c.t)(a,"trustScore.overrideActive")})]})]}),null!==o.scoreOverride&&(0,s.jsxs)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3",children:[(0,s.jsx)("div",{className:"text-[11px] uppercase text-black/50",children:(0,c.t)(a,"trustScore.overrideInfo")}),(0,s.jsxs)("div",{className:"mt-2 text-[12px] text-black/80",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("strong",{children:[(0,c.t)(a,"trustScore.overrideScore"),":"]})," ",o.scoreOverride]}),o.overrideReason&&(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsxs)("strong",{children:[(0,c.t)(a,"trustScore.overrideReason"),":"]})," ",o.overrideReason]}),o.overrideAt&&(0,s.jsx)("div",{className:"mt-1 text-[11px] text-black/50",children:new Date(o.overrideAt).toLocaleString()})]})]})]}),(0,s.jsxs)("div",{className:"mt-4 border-t border-black/10 pt-4",children:[(0,s.jsx)("div",{className:"text-[13px] font-semibold text-black",children:(0,c.t)(a,"trustScore.manageOverride")}),(0,s.jsxs)("div",{className:"mt-3 grid gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[12px] text-black/70",children:(0,c.t)(a,"trustScore.overrideScoreLabel")}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",value:w,onChange:e=>S(e.target.value),placeholder:"0-100",className:"mt-1 w-full rounded-lg border border-black/20 px-3 py-2 text-[13px] text-black focus:border-black focus:outline-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[12px] text-black/70",children:(0,c.t)(a,"trustScore.overrideReasonLabel")}),(0,s.jsx)("textarea",{value:T,onChange:e=>O(e.target.value),rows:2,maxLength:200,placeholder:(0,c.t)(a,"trustScore.overrideReasonPlaceholder"),className:"mt-1 w-full rounded-lg border border-black/20 px-3 py-2 text-[13px] text-black focus:border-black focus:outline-none"}),(0,s.jsxs)("div",{className:"mt-1 text-[11px] text-black/50",children:[T.length,"/200"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:I,disabled:C,className:"rounded-lg border border-black/20 bg-black px-4 py-2 text-[12px] font-semibold text-white hover:bg-black/80 disabled:opacity-60",children:(0,c.t)(a,"trustScore.saveOverride")}),null!==o.scoreOverride&&(0,s.jsx)("button",{type:"button",onClick:H,disabled:C,className:"rounded-lg border border-black/20 px-4 py-2 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,c.t)(a,"trustScore.clearOverride")}),null===o.scoreOverride&&(0,s.jsx)("button",{type:"button",onClick:_,disabled:P,className:"rounded-lg border border-black/20 px-4 py-2 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,c.t)(a,"trustScore.recalculate")})]})]})]})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,c.t)(a,"leads.notesTitle")}),(0,s.jsx)("div",{className:"text-[12px] text-black/60",children:(0,c.t)(a,"leads.notesHelper")})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)("textarea",{value:h,onChange:e=>{f(e.target.value),v&&j(null)},rows:3,placeholder:(0,c.t)(a,"leads.notesPlaceholder"),className:"w-full rounded-lg border border-black/20 p-3 text-[13px] text-black focus:border-black focus:outline-none"}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[(0,s.jsxs)("span",{children:[h.trim().length,"/2000"]}),(0,s.jsx)("button",{type:"button",onClick:G,disabled:N,className:"rounded-lg border border-black/20 px-3 py-1 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,c.t)(a,"leads.notesAdd")})]}),v&&(0,s.jsx)("div",{className:"text-[12px] text-red-600",children:v})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-3",children:[0===o.notes.length&&(0,s.jsx)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3 text-[12px] text-black/60",children:(0,c.t)(a,"leads.notesNone")}),o.notes.map(e=>(0,s.jsxs)("div",{className:"rounded-lg border border-black/10 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()}),(0,s.jsx)("span",{children:e.author||"admin"})]}),(0,s.jsx)("p",{className:"mt-2 whitespace-pre-line text-[13px] text-black/80",children:e.content})]},e.id))]})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[(0,s.jsx)("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,c.t)(a,"leads.auditTitle")}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[0===o.audits.length&&(0,s.jsx)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3 text-[12px] text-black/60",children:(0,c.t)(a,"leads.auditNone")}),o.audits.map(e=>{let t="leadAudit.".concat(e.action),l=(0,c.t)(a,t);return(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-black/10 px-3 py-2 text-[12px] text-black/70",children:[(0,s.jsx)("span",{children:l}),(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]},e.id)})]})]})]})]})}},9064:function(e,t,a){"use strict";function s(e){var t;let[a,s]=e.split("@");if(!a||!s)return e;let l=null!==(t=a[0])&&void 0!==t?t:"";return"".concat(l,"***@").concat(s)}function l(e){let t=e.replace(/\D/g,"");if(t.length<=3)return"".concat(t,"***");let a=t.slice(-3);return"***".concat(a)}function r(e){var t;if(!e)return e;let a=null!==(t=e.trim()[0])&&void 0!==t?t:"";return"".concat(a,"***")}a.d(t,{of:function(){return s},u3:function(){return r},yD:function(){return l}})},5876:function(e,t,a){"use strict";a.d(t,{PT:function(){return s}});let s=["NEW","IN_REVIEW","OFFER_SENT","CLOSED"]}},function(e){e.O(0,[36,971,23,744],function(){return e(e.s=7566)}),_N_E=e.O()}]);