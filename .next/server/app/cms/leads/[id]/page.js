(()=>{var e={};e.id=1190,e.ids=[1190],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5375:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>c}),s(6168),s(6042),s(5866);var a=s(3191),r=s(8716),l=s(7922),d=s.n(l),i=s(5231),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);s.d(t,n);let c=["",{children:["cms",{children:["leads",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6168)),"C:\\Users\\MustafaNazliHamiTour\\Desktop\\MedDiscover\\03-platform\\M01-lead-intake\\src\\app\\cms\\leads\\[id]\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6042)),"C:\\Users\\MustafaNazliHamiTour\\Desktop\\MedDiscover\\03-platform\\M01-lead-intake\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\MustafaNazliHamiTour\\Desktop\\MedDiscover\\03-platform\\M01-lead-intake\\src\\app\\cms\\leads\\[id]\\page.tsx"],x="/cms/leads/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/cms/leads/[id]/page",pathname:"/cms/leads/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7493:(e,t,s)=>{Promise.resolve().then(s.bind(s,9709))},5047:(e,t,s)=>{"use strict";var a=s(7389);s.o(a,"notFound")&&s.d(t,{notFound:function(){return a.notFound}}),s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},9709:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(326),r=s(7577),l=s(5047),d=s(7234),i=s(8434),n=s(1030),c=s(5439);function o(){let e=(0,l.useParams)();e?.id;let{uiLocale:t}=(0,i.s)("de"),[s,o]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[p,m]=(0,r.useState)(!1),[b,h]=(0,r.useState)(""),[f,v]=(0,r.useState)(null),[g,j]=(0,r.useState)(!1),[k,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)(""),[S,P]=(0,r.useState)(""),[T,C]=(0,r.useState)(!1),[M,O]=(0,r.useState)(!1),_=e=>(0,d.t)(t,`leadStatus.${e}`),D=(0,r.useMemo)(()=>{if(!s)return"-";let e=s.name||s.patientName||"";return e?(0,c.u3)(e):"-"},[s]),A=(0,r.useMemo)(()=>s?.email?(0,c.of)(s.email):"-",[s]),$=(0,r.useMemo)(()=>s?.phone?(0,c.yD)(s.phone):"-",[s]),E=async()=>{if(s){O(!0);try{let e=await fetch(`/api/cms/leads/${s.id}/trustscore/recalc`,{method:"POST"});if(!e.ok){let t=await e.json();alert(t.error||"Failed to recalculate");return}let t=await e.json();o(e=>e?{...e,trustScore:t.scoreAfter,trustStatus:t.status}:e)}finally{O(!1)}}},q=async()=>{if(!s)return;let e=S.trim(),t=""===y.trim()?null:parseInt(y);if(null!==t&&(isNaN(t)||t<0||t>100)){alert("Score must be between 0 and 100");return}C(!0);try{let a=await fetch(`/api/cms/leads/${s.id}/trustscore/override`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({scoreOverride:t,reason:e||null})});if(!a.ok){let e=await a.json();alert(e.error||"Failed to update override");return}await a.json();let r=await fetch(`/api/cms/leads/${s.id}`,{method:"GET"}),l=await r.json();o(l.lead),w(""),P("")}finally{C(!1)}},L=async()=>{if(s){w(""),P(""),C(!0);try{let e=await fetch(`/api/cms/leads/${s.id}/trustscore/override`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({scoreOverride:null})});if(!e.ok){let t=await e.json();alert(t.error||"Failed to clear override");return}let t=await fetch(`/api/cms/leads/${s.id}`,{method:"GET"}),a=await t.json();o(a.lead)}finally{C(!1)}}},R=async e=>{if(s&&s.status!==e){j(!0);try{let t=await fetch(`/api/cms/leads/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})});if(!t.ok)throw Error("Failed");let a=await t.json();o(e=>e?{...e,status:a.lead.status}:e)}finally{j(!1)}}},F=async()=>{let e=b.trim();if(!e){v((0,d.t)(t,"leads.notesEmpty"));return}if(e.length<2){v((0,d.t)(t,"leads.notesTooShort"));return}if(e.length>2e3){v((0,d.t)(t,"leads.notesTooLong"));return}if(s){N(!0),v(null);try{let t=await fetch(`/api/cms/leads/${s.id}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});if(!t.ok)throw Error("Failed");let a=await t.json();o(a.lead),h("")}finally{N(!1)}}};return x?a.jsx("main",{className:"min-h-screen bg-white px-6 py-8 text-[13px] text-black/60",children:(0,d.t)(t,"leads.loading")}):p||!s?a.jsx("main",{className:"min-h-screen bg-white px-6 py-8 text-[13px] text-black/60",children:(0,d.t)(t,"leads.empty")}):(0,a.jsxs)("main",{className:"min-h-screen bg-white",children:[a.jsx("div",{className:"border-b border-black/10",children:(0,a.jsxs)("div",{className:"mx-auto flex w-full max-w-[1000px] flex-col gap-2 px-6 py-6",children:[a.jsx("h1",{className:"text-2xl font-semibold text-black",children:(0,d.t)(t,"leads.detailTitle")}),a.jsx("p",{className:"text-[13px] text-black/60",children:(0,d.t)(t,"leads.detailInfo")})]})}),(0,a.jsxs)("section",{className:"mx-auto w-full max-w-[1000px] px-6 py-8",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-black/10 bg-white p-4",children:[a.jsx("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,d.t)(t,"leads.detailInfo")}),(0,a.jsxs)("div",{className:"mt-3 grid gap-2 text-[13px] text-black",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldId"),":"]})," ",s.id]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldCreatedAt"),":"]})," ",new Date(s.createdAt).toLocaleString()]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldLocale"),":"]})," ",s.locale||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldName"),":"]})," ",D]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldEmail"),":"]})," ",A]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-black/50",children:[(0,d.t)(t,"leads.fieldPhone"),":"]})," ",$]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-black/10 bg-white p-4",children:[a.jsx("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,d.t)(t,"leads.statusLabel")}),a.jsx("div",{className:"mt-3 grid gap-3",children:a.jsx("select",{value:s.status,onChange:e=>R(e.target.value),disabled:g,className:"h-10 rounded-lg border border-black/20 px-3 text-[13px] text-black focus:border-black focus:outline-none",children:n.PT.map(e=>a.jsx("option",{value:e,children:_(e)},e))})})]})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[a.jsx("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,d.t)(t,"trustScore.panelTitle")}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3",children:[a.jsx("div",{className:"text-[11px] uppercase text-black/50",children:(0,d.t)(t,"trustScore.finalScore")}),a.jsx("div",{className:"mt-1 text-2xl font-bold text-black",children:s.trustScore}),(0,a.jsxs)("div",{className:"mt-1 text-[11px] text-black/60",children:[(0,d.t)(t,`trustScore.status.${s.trustStatus}`),null!==s.scoreOverride&&a.jsx("span",{className:"ml-2 rounded bg-yellow-200 px-1.5 py-0.5 text-[10px] font-semibold text-yellow-800",children:(0,d.t)(t,"trustScore.overrideActive")})]})]}),null!==s.scoreOverride&&(0,a.jsxs)("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3",children:[a.jsx("div",{className:"text-[11px] uppercase text-black/50",children:(0,d.t)(t,"trustScore.overrideInfo")}),(0,a.jsxs)("div",{className:"mt-2 text-[12px] text-black/80",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[(0,d.t)(t,"trustScore.overrideScore"),":"]})," ",s.scoreOverride]}),s.overrideReason&&(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("strong",{children:[(0,d.t)(t,"trustScore.overrideReason"),":"]})," ",s.overrideReason]}),s.overrideAt&&a.jsx("div",{className:"mt-1 text-[11px] text-black/50",children:new Date(s.overrideAt).toLocaleString()})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 border-t border-black/10 pt-4",children:[a.jsx("div",{className:"text-[13px] font-semibold text-black",children:(0,d.t)(t,"trustScore.manageOverride")}),(0,a.jsxs)("div",{className:"mt-3 grid gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-[12px] text-black/70",children:(0,d.t)(t,"trustScore.overrideScoreLabel")}),a.jsx("input",{type:"number",min:"0",max:"100",value:y,onChange:e=>w(e.target.value),placeholder:"0-100",className:"mt-1 w-full rounded-lg border border-black/20 px-3 py-2 text-[13px] text-black focus:border-black focus:outline-none"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-[12px] text-black/70",children:(0,d.t)(t,"trustScore.overrideReasonLabel")}),a.jsx("textarea",{value:S,onChange:e=>P(e.target.value),rows:2,maxLength:200,placeholder:(0,d.t)(t,"trustScore.overrideReasonPlaceholder"),className:"mt-1 w-full rounded-lg border border-black/20 px-3 py-2 text-[13px] text-black focus:border-black focus:outline-none"}),(0,a.jsxs)("div",{className:"mt-1 text-[11px] text-black/50",children:[S.length,"/200"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:q,disabled:T,className:"rounded-lg border border-black/20 bg-black px-4 py-2 text-[12px] font-semibold text-white hover:bg-black/80 disabled:opacity-60",children:(0,d.t)(t,"trustScore.saveOverride")}),null!==s.scoreOverride&&a.jsx("button",{type:"button",onClick:L,disabled:T,className:"rounded-lg border border-black/20 px-4 py-2 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,d.t)(t,"trustScore.clearOverride")}),null===s.scoreOverride&&a.jsx("button",{type:"button",onClick:E,disabled:M,className:"rounded-lg border border-black/20 px-4 py-2 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,d.t)(t,"trustScore.recalculate")})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,d.t)(t,"leads.notesTitle")}),a.jsx("div",{className:"text-[12px] text-black/60",children:(0,d.t)(t,"leads.notesHelper")})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[a.jsx("textarea",{value:b,onChange:e=>{h(e.target.value),f&&v(null)},rows:3,placeholder:(0,d.t)(t,"leads.notesPlaceholder"),className:"w-full rounded-lg border border-black/20 p-3 text-[13px] text-black focus:border-black focus:outline-none"}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[(0,a.jsxs)("span",{children:[b.trim().length,"/2000"]}),a.jsx("button",{type:"button",onClick:F,disabled:k,className:"rounded-lg border border-black/20 px-3 py-1 text-[12px] font-semibold text-black hover:bg-black/5 disabled:opacity-60",children:(0,d.t)(t,"leads.notesAdd")})]}),f&&a.jsx("div",{className:"text-[12px] text-red-600",children:f})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[0===s.notes.length&&a.jsx("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3 text-[12px] text-black/60",children:(0,d.t)(t,"leads.notesNone")}),s.notes.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border border-black/10 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-[12px] text-black/50",children:[a.jsx("span",{children:new Date(e.createdAt).toLocaleString()}),a.jsx("span",{children:e.author||"admin"})]}),a.jsx("p",{className:"mt-2 whitespace-pre-line text-[13px] text-black/80",children:e.content})]},e.id))]})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-xl border border-black/10 bg-white p-4",children:[a.jsx("div",{className:"text-[12px] uppercase tracking-wide text-black/50",children:(0,d.t)(t,"leads.auditTitle")}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[0===s.audits.length&&a.jsx("div",{className:"rounded-lg border border-black/10 bg-black/5 p-3 text-[12px] text-black/60",children:(0,d.t)(t,"leads.auditNone")}),s.audits.map(e=>{let s=`leadAudit.${e.action}`,r=(0,d.t)(t,s);return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-black/10 px-3 py-2 text-[12px] text-black/70",children:[a.jsx("span",{children:r}),a.jsx("span",{children:new Date(e.createdAt).toLocaleString()})]},e.id)})]})]})]})]})}},5439:(e,t,s)=>{"use strict";function a(e){let[t,s]=e.split("@");if(!t||!s)return e;let a=t[0]??"";return`${a}***@${s}`}function r(e){let t=e.replace(/\D/g,"");if(t.length<=3)return`${t}***`;let s=t.slice(-3);return`***${s}`}function l(e){if(!e)return e;let t=e.trim()[0]??"";return`${t}***`}s.d(t,{of:()=>a,u3:()=>l,yD:()=>r})},1030:(e,t,s)=>{"use strict";s.d(t,{PT:()=>a});let a=["NEW","IN_REVIEW","OFFER_SENT","CLOSED"]},6168:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>d,__esModule:()=>l,default:()=>i});var a=s(8570);let r=(0,a.createProxy)(String.raw`C:\Users\MustafaNazliHamiTour\Desktop\MedDiscover\03-platform\M01-lead-intake\src\app\cms\leads\[id]\page.tsx`),{__esModule:l,$$typeof:d}=r;r.default;let i=(0,a.createProxy)(String.raw`C:\Users\MustafaNazliHamiTour\Desktop\MedDiscover\03-platform\M01-lead-intake\src\app\cms\leads\[id]\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,4471,6333],()=>s(5375));module.exports=a})();