"use strict";(()=>{var t={};t.id=5398,t.ids=[5398],t.modules={3524:t=>{t.exports=require("@prisma/client")},2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7295:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>S,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d});var a=r(9303),u=r(8716),o=r(670),n=r(7070),i=r(3538),c=r(6890);async function d(t){let e=(0,c.k)(t);if(e)return e;try{let[t,e,r,s]=await Promise.all([i._.lead.aggregate({_avg:{trustScore:!0}}),i._.lead.count(),i._.lead.groupBy({by:["trustStatus"],_count:{trustStatus:!0}}),i._.lead.findMany({where:{trustStatus:{in:["RISKY_HIDDEN","BLACKLISTED"]}},orderBy:{trustScore:"asc"},take:10,select:{id:!0,trustScore:!0,trustStatus:!0,trustUpdatedAt:!0}})]),a={active:0,riskyHidden:0,blacklisted:0};for(let t of r)switch(t.trustStatus){case"ACTIVE":a.active=t._count.trustStatus;break;case"RISKY_HIDDEN":a.riskyHidden=t._count.trustStatus;break;case"BLACKLISTED":a.blacklisted=t._count.trustStatus}let u=e>0?Math.round(t._avg.trustScore??0):0,o=s.map(t=>({leadId:t.id,score:t.trustScore,trustStatus:t.trustStatus,updatedAt:t.trustUpdatedAt?.toISOString()||null}));return n.NextResponse.json({counts:a,avgScore:u,topRisky:o})}catch(t){return console.error("[TrustScore Summary] Error:",t),n.NextResponse.json({error:"Failed to fetch trust score summary"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/cms/trustscore/summary/route",pathname:"/api/cms/trustscore/summary",filename:"route",bundlePath:"app/api/cms/trustscore/summary/route"},resolvedPagePath:"C:\\Users\\MustafaNazliHamiTour\\Desktop\\MedDiscover\\03-platform\\M01-lead-intake\\src\\app\\api\\cms\\trustscore\\summary\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:S}=p,x="/api/cms/trustscore/summary/route";function y(){return(0,o.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:m})}}};var e=require("../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),s=e.X(0,[8948,5972,600],()=>r(7295));module.exports=s})();