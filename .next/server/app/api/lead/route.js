"use strict";(()=>{var e={};e.id=3558,e.ids=[3558],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4517:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>P,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>A,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>m});var s=r(9303),n=r(8716),o=r(670),i=r(7070),l=r(1067),u=r(3538),d=r(9834);let p=l.Km(["WHATSAPP","PHONE","EMAIL"]),c=l.Ry({patientName:l.Z_().min(2,"Hasta adı en az 2 karakter olmalı").max(80,"Hasta adı en fazla 80 karakter olabilir"),country:l.Z_().regex(/^[A-Z]{2}$/,"Ge\xe7erli bir \xfclke kodu giriniz (\xf6rn: DE, TR)"),contactPreference:p,requestedProcedure:l.Z_().min(3,"İşlem a\xe7ıklaması en az 3 karakter olmalı").max(2e3,"İşlem a\xe7ıklaması en fazla 2000 karakter olabilir"),gdprConsent:l.i0(!0,{errorMap:()=>({message:"GDPR onayı zorunludur"})})});async function m(e){let t=(0,d.h)(e,d.f.LEAD_SUBMISSION);if(t)return t;try{let t=await e.json(),r=c.safeParse(t);if(!r.success){let e={};for(let t of r.error.issues){let r=t.path[0];e[r]||(e[r]=[]),e[r].push(t.message)}return i.NextResponse.json({error:"Validation failed",fieldErrors:e},{status:400})}let a=await u._.lead.create({data:{patientName:r.data.patientName,country:r.data.country,contactPreference:r.data.contactPreference,requestedProcedure:r.data.requestedProcedure,gdprConsent:r.data.gdprConsent,status:"NEW"},select:{id:!0,createdAt:!0}});return i.NextResponse.json(a,{status:201})}catch(e){return console.error("Lead creation error:",e),i.NextResponse.json({error:"Internal server error",fieldErrors:{}},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/lead/route",pathname:"/api/lead",filename:"route",bundlePath:"app/api/lead/route"},resolvedPagePath:"C:\\Users\\MustafaNazliHamiTour\\Desktop\\MedDiscover\\03-platform\\M01-lead-intake\\src\\app\\api\\lead\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:A}=f,R="/api/lead/route";function P(){return(0,o.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:g})}},3538:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(3524);let s=globalThis.prisma??new a.PrismaClient},9834:(e,t,r)=>{r.d(t,{f:()=>i,h:()=>o});var a=r(7070);let s=new Map;setInterval(()=>{let e=Date.now();for(let[t,r]of Array.from(s.entries()))r.resetAt<e&&s.delete(t)},3e5);let n={maxRequests:10,windowMs:6e4};function o(e,t=n){let r=function(e){let t=e.headers.get("x-forwarded-for"),r=e.headers.get("x-real-ip");return t?t.split(",")[0].trim():r||"unknown"}(e),o=`${r}`,i=Date.now(),l=s.get(o);if(!l||l.resetAt<i)return l={count:1,resetAt:i+t.windowMs},s.set(o,l),null;if(l.count+=1,l.count>t.maxRequests){let e=Math.ceil((l.resetAt-i)/1e3);return a.NextResponse.json({error:"Too many requests. Please try again later.",retryAfter:`${e} seconds`},{status:429,headers:{"Retry-After":e.toString(),"X-RateLimit-Limit":t.maxRequests.toString(),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":l.resetAt.toString()}})}return null}let i={LEAD_SUBMISSION:{maxRequests:10,windowMs:6e4},ADMIN_AUTH:{maxRequests:5,windowMs:6e4}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1067],()=>r(4517));module.exports=a})();